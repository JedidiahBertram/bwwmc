<!DOCTYPE html>
<html lang="en">
  <head>
    <head>
        <meta charset="utf-8">
        <title>Order Delivery</title>
        <!-- Bootstrap -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
        <%# Google Fonts%>
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <%# Stylesheet%>
        <link rel="stylesheet" href="/css/menu.css">
    </head>
      <script>

          var todaysDate = new Date();
          $(document).ready(function(){
            var date_input=$('input[name="date"]'); //our date input has the name "date"
            var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
            var options={
              format: 'mm/dd/yyyy',
              container: container,
              todayHighlight: true,
              autoclose: true,
              daysOfWeekDisabled: [0, 6],
              startDate: todaysDate,
            };
            date_input.datepicker(options);
          });
      </script>
      <script>
      $(document).ready(function () {
          $('.recurrenceDD').hide();
          $('#recurringCB').click(function () {
            console.log('recurrenceCB clicked')
              $( ".recurrenceDD" ).show( "slow", function() {
              });
          });
      });
      </script>

      <script>
      //The action for the submit button
      //Gathers the schedule date and the status of the recurring delivery
      //checkbox and the value of the schedule dropdown
      function sendOrderToRoute(){
            var schedDate = $('.datePickerText').val();
            //var recurring = $('#recurringCB')[0].checked;
            //var ddVal = $('#recurrenceDD :selected').text();

            if(!schedDate){
              alert("Please schedule a delivery date");
            }
            console.log("Local Storage.cart", JSON.parse(localStorage.cart))

            var order = {
              'menuItemID': JSON.parse(localStorage.cart)[0].id,
              'quantity': JSON.parse(localStorage.cart)[0].quantity,
              'item_price': JSON.parse(localStorage.cart)[0].item_price,
              'schedDate': schedDate//,
              //'recurring': recurring,
              //'frequency': ddVal
            };

            console.log('view order = ', order);

            //ajax call to the appropriate route
            var request = $.ajax({
              url: "http://localhost:3000/orders",
              method: "POST",
              data: order,
              dataType: "json"
            });
          };
      </script>
  </head>


  <body class="container">
      <%- include('../templates/logged_in_not_home_nav'); %>
      <div class="h1Container row">
        <h1>Schedule Delivery</h1>
      </div>
      <form class="row" action="/orders/order_confirmation" method="GET">
         <input class="datePickerText col-xs-8 col-xs-offset-2" id="dateText" name="date" value="Select a delivery date" type="text"/>
         <input class="formField col-xs-8 col-xs-offset-2" type="text" placeholder="Name">
         <input class="formField col-xs-8 col-xs-offset-2" type="text" placeholder="Street Address">
         <input class="formField col-xs-8 col-xs-offset-2"type="text" placeholder="City">
         <input class="formField col-xs-8 col-xs-offset-2"type="text" placeholder="State">
         <input class="formField col-xs-8 col-xs-offset-2"type="text" placeholder="Zip Code">
         <input id="submitSchedule" type="submit" class="btn btn-custom btn-lg confirm col-xs-12 col-md-4 col-md-offset-4" value="Submit Order" onclick="sendOrderToRoute()"></button>
      </form>
  </body>
</html>
